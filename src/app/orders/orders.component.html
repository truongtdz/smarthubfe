<div class="page-content">
<div class="container my-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h3 class="text-primary fw-bold">
      <i class="bi bi-clock-history me-2"></i>Lịch sử đơn hàng
    </h3>
    <a routerLink="/admin" class="btn btn-outline-primary">
      <i class="bi bi-arrow-left me-1"></i>Về trang chủ
    </a>
  </div>

  <div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Đang tải...</span>
    </div>
  </div>

  <div *ngIf="!isLoading && orders.length === 0" class="text-center py-5">
    <i class="bi bi-cart-x display-1 text-muted"></i>
    <p class="mt-3 text-muted">Chưa có đơn hàng nào</p>
  </div>

  <div class="row g-3" *ngIf="!isLoading && orders.length > 0">
    <div class="col-12" *ngFor="let order of orders">
      <div class="card shadow-sm">
        <div class="card-body">
          <div class="row">
            <div class="col-md-8">
              <h6 class="mb-2">
                <i class="bi bi-receipt me-1"></i>Đơn hàng #{{ order.id }}
              </h6>
              <p class="text-muted small mb-1">
                <i class="bi bi-calendar me-1"></i>{{ formatDate(order.createdAt) }}
              </p>
              <p class="text-muted small mb-1">
                <i class="bi bi-telephone me-1"></i>{{ order.phone }}
              </p>
              <p class="text-muted small mb-0">
                <i class="bi bi-geo-alt me-1"></i>{{ order.address }}
              </p>
            </div>
            <div class="col-md-4 text-md-end">
              <p class="mb-2">
                <span class="text-muted">Số lượng:</span>
                <strong class="ms-2">{{ order.orderItems.length }} sản phẩm</strong>
              </p>
              <div class="d-flex justify-content-end align-items-center gap-2 mb-2">
                <h5 class="text-danger fw-bold mb-0">
                  {{ formatPrice(order.totalAmount) }}
                </h5>
                <span
                  *ngIf="order.status === 1"
                  class="badge bg-success">
                  Đã thanh toán
                </span>
                <span
                  *ngIf="order.status === 0"
                  class="badge bg-warning text-dark">
                  Chưa thanh toán
                </span>
              </div>

              <button
                class="btn btn-primary btn-sm"
                data-bs-toggle="modal"
                data-bs-target="#orderDetailModal"
                (click)="viewOrderDetail(order)">
                <i class="bi bi-eye me-1"></i>Xem chi tiết
              </button>
              <button
                *ngIf="order.isConfirm !== 1"
                class="btn btn-primary btn-sm"
                (click)="viewConfirmOrder(order.id!)">
                <i class="bi bi-eye me-1"></i>Xác nhận đơn hàng
              </button>
              <button
                *ngIf="order.isConfirm === 1"
                [disabled]="order.isConfirm === 1"
                class="btn btn-primary btn-sm"
                (click)="viewConfirmOrder(order.id!)">
                <i class="bi bi-eye me-1"></i>Đã xác nhận
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal Chi tiết đơn hàng -->
<div class="modal fade" id="orderDetailModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content" *ngIf="selectedOrder">
      <div class="modal-header">
        <h5 class="modal-title">
          <i class="bi bi-receipt me-2"></i>Chi tiết đơn hàng #{{ selectedOrder.id }}
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <div class="mb-3">
          <h6 class="fw-bold">Thông tin giao hàng</h6>
          <p class="mb-1"><strong>SĐT:</strong> {{ selectedOrder.phone }}</p>
          <p class="mb-1"><strong>Địa chỉ:</strong> {{ selectedOrder.address }}</p>
          <p class="mb-0"><strong>Ngày đặt:</strong> {{ formatDate(selectedOrder.createdAt) }}</p>
        </div>

        <hr>

        <h6 class="fw-bold mb-3">Sản phẩm đã đặt</h6>
        <div class="list-group">
          <div class="list-group-item" *ngFor="let item of selectedOrder.orderItems">
            <div class="row align-items-center">
              <div class="col-md-2">
                <img
                  [src]="getProduct(item.product.id)?.imageUrl || 'https://via.placeholder.com/80'"
                  class="img-fluid"
                  style="max-height: 80px; object-fit: contain;">
              </div>
              <div class="col-md-5">
                <h6 class="mb-1">{{ getProduct(item.product.id)?.name }}</h6>
                <small class="text-muted">{{ formatPrice(item.product.price) }}</small>
              </div>
              <div class="col-md-2 text-center">
                <span class="badge bg-secondary">x{{ item.quantity }}</span>
              </div>
              <div class="col-md-3 text-end">
                <strong class="text-danger">
                  {{ formatPrice(item.product.price? item.product.price : 0 * item.quantity) }}
                </strong>
              </div>
            </div>
          </div>
        </div>

        <div class="mt-3 pt-3 border-top">
          <div class="d-flex justify-content-between align-items-center">
            <h5>Tổng cộng:</h5>
            <h4 class="text-danger fw-bold">{{ formatPrice(selectedOrder.totalAmount) }}</h4>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Đóng
        </button></div>
    </div>
  </div>
</div>
</div>
<div class="modal-overlay" *ngIf="showConfirmDeleteModal" (click)="showConfirmDeleteModal = false">
  <div class="modal-dialog modal-dialog-cen tered" style="max-width: 40%" (click)="$event.stopPropagation()">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Xác nhận đơn hàng</h5>
        <button type="button" class="btn-close" (click)="showConfirmDeleteModal = false"></button>
      </div>
      <div class="modal-body">
        <p>Bạn có chắc chắn muốn xác nhận đơn hàng?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="showConfirmDeleteModal = false">Hủy</button>
        <button type="button" class="btn btn-success" (click)="confirmOrder()">
          Xác nhận
        </button>
      </div>
    </div>
  </div>
</div>
